Project twitter_mvp {
  database_type: "PostgreSQL"
  note: "Full Twitter Text-Only MVP â€” Strict 3NF Schema"
}

///////////////////////////////////////////////////////
// USERS
///////////////////////////////////////////////////////

Table users {
  id int [pk, increment]
  username varchar(50) [unique, not null]
  password varchar(255) [not null]

  bio text
  location varchar(100)
  website varchar(255)

  created_at timestamp [default: `now()`]
  is_suspended boolean [default: false]
  is_deleted boolean [default: false]
}

///////////////////////////////////////////////////////
// USER BLOCKS (Anti-abuse)
///////////////////////////////////////////////////////

Table blocks {
  id int [pk, increment]
  blocker_id int [not null, ref: > users.id]
  blocked_id int [not null, ref: > users.id]
  created_at timestamp [default: `now()`]

  indexes {
    (blocker_id, blocked_id) [unique]
  }
}

///////////////////////////////////////////////////////
// POSTS
///////////////////////////////////////////////////////

Table posts {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]

  content varchar(280) [not null]

  parent_post_id int [ref: > posts.id]  // Replies / threads

  created_at timestamp [default: `now()`]
  is_deleted boolean [default: false]

  indexes {
    user_id
    created_at
    parent_post_id
  }
}

///////////////////////////////////////////////////////
// POST REPORTS (Moderation)
///////////////////////////////////////////////////////

Table post_reports {
  id int [pk, increment]
  post_id int [not null, ref: > posts.id]
  reporter_id int [not null, ref: > users.id]
  reason varchar(255)
  created_at timestamp [default: `now()`]

  indexes {
    (post_id)
    (reporter_id)
  }
}

///////////////////////////////////////////////////////
// LIKES
///////////////////////////////////////////////////////

Table likes {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  post_id int [not null, ref: > posts.id]
  created_at timestamp [default: `now()`]

  indexes {
    (user_id, post_id) [unique]
    post_id
  }
}

///////////////////////////////////////////////////////
// FOLLOWS
///////////////////////////////////////////////////////

Table follows {
  id int [pk, increment]
  follower_id int [not null, ref: > users.id]
  following_id int [not null, ref: > users.id]
  created_at timestamp [default: `now()`]

  indexes {
    (follower_id, following_id) [unique]
    follower_id
    following_id
  }
}

///////////////////////////////////////////////////////
// BOOKMARKS
///////////////////////////////////////////////////////

Table bookmarks {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  post_id int [not null, ref: > posts.id]
  created_at timestamp [default: `now()`]

  indexes {
    (user_id, post_id) [unique]
  }
}

///////////////////////////////////////////////////////
// NOTIFICATIONS
///////////////////////////////////////////////////////

Table notifications {
  id int [pk, increment]

  user_id int [not null, ref: > users.id]       // Receiver
  actor_id int [ref: > users.id]                // Optional actor

  verb varchar(255) [not null]                  // "liked_post", etc.
  target_id int                                 // e.g. post_id
  target_type varchar(50)                       // "post", "user"

  is_read boolean [default: false]
  created_at timestamp [default: `now()`]

  indexes {
    user_id
    is_read
  }
}

///////////////////////////////////////////////////////
// DIRECT MESSAGES (DM)
///////////////////////////////////////////////////////

Table user_messages {
  id int [pk, increment]
  sender_id int [not null, ref: > users.id]
  receiver_id int [not null, ref: > users.id]

  content text [not null]
  is_read boolean [default: false]

  created_at timestamp [default: `now()`]

  indexes {
    sender_id
    receiver_id
  }
}

///////////////////////////////////////////////////////
// COMMUNITIES
///////////////////////////////////////////////////////

Table communities {
  id int [pk, increment]
  name varchar(255) [not null]
  description text
  owner_id int [not null, ref: > users.id]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// COMMUNITY MEMBERS
///////////////////////////////////////////////////////

Table community_members {
  id int [pk, increment]
  community_id int [not null, ref: > communities.id]
  user_id int [not null, ref: > users.id]
  joined_at timestamp [default: `now()`]

  indexes {
    (community_id, user_id) [unique]
  }
}

///////////////////////////////////////////////////////
// COMMUNITY POSTS
///////////////////////////////////////////////////////

Table community_posts {
  id int [pk, increment]
  community_id int [not null, ref: > communities.id]
  user_id int [not null, ref: > users.id]
  content text [not null]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// HASHTAGS
///////////////////////////////////////////////////////
// Strict 3NF: Hashtag is independent entity.

Table hashtags {
  id int [pk, increment]
  tag varchar(100) [unique, not null]
}

///////////////////////////////////////////////////////
// POST-HASHTAG JOIN TABLE
///////////////////////////////////////////////////////

Table post_hashtags {
  id int [pk, increment]
  post_id int [not null, ref: > posts.id]
  hashtag_id int [not null, ref: > hashtags.id]

  indexes {
    (post_id, hashtag_id) [unique]
  }
}

///////////////////////////////////////////////////////
// LOGIN LOGS (Security)
///////////////////////////////////////////////////////

Table login_logs {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  ip_address varchar(50)
  user_agent text
  created_at timestamp [default: `now()`]

  indexes {
    user_id
  }
}
