Project twitter_mvp {
  database_type: "PostgreSQL"
  note: "Minimal Twitter MVP Expanded - STRICT 3NF"
}

///////////////////////////////////////////////////////
// USERS
///////////////////////////////////////////////////////

Table users {
  id int [pk, increment]
  username varchar(50) [unique, not null]
  password varchar(255) [not null]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// POSTS
///////////////////////////////////////////////////////

Table posts {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  content varchar(280) [not null]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// LIKES
///////////////////////////////////////////////////////

Table likes {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  post_id int [not null, ref: > posts.id]
  created_at timestamp [default: `now()`]

  indexes {
    (user_id, post_id) [unique]
  }
}

///////////////////////////////////////////////////////
// FOLLOWS
///////////////////////////////////////////////////////

Table follows {
  id int [pk, increment]
  follower_id int [not null, ref: > users.id]
  following_id int [not null, ref: > users.id]
  created_at timestamp [default: `now()`]

  indexes {
    (follower_id, following_id) [unique]
  }
}

///////////////////////////////////////////////////////
// BOOKMARKS (PHASE 1 COMPLETED)
///////////////////////////////////////////////////////

Table bookmarks {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  post_id int [not null, ref: > posts.id]
  created_at timestamp [default: `now()`]

  indexes {
    (user_id, post_id) [unique]
  }
}

///////////////////////////////////////////////////////
// NOTIFICATIONS
///////////////////////////////////////////////////////
// 3NF: A notification only stores scalar facts.
// No redundant actor or target info.

Table notifications {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]       // Receiver
  actor_id int [ref: > users.id]                // Optional actor
  verb varchar(255) [not null]                  // "liked_post", "followed_you"
  target_id int                                 // e.g. post_id
  target_type varchar(50)                       // "post", "user", "community"
  is_read boolean [default: false]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// MESSAGES (DM)
///////////////////////////////////////////////////////
// 3NF: no derived attributes.
// No duplicated usernames.

Table usermessages {
  id int [pk, increment]
  sender_id int [not null, ref: > users.id]
  receiver_id int [not null, ref: > users.id]
  content text [not null]
  is_read boolean [default: false]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// COMMUNITIES
///////////////////////////////////////////////////////
// 3NF: community stores only intrinsic properties.

Table communities {
  id int [pk, increment]
  name varchar(255) [not null]
  description text
  owner_id int [not null, ref: > users.id]
  created_at timestamp [default: `now()`]
}

///////////////////////////////////////////////////////
// COMMUNITY MEMBERS
///////////////////////////////////////////////////////
// 3NF: joining table for many-to-many membership.

Table community_members {
  id int [pk, increment]
  community_id int [not null, ref: > communities.id]
  user_id int [not null, ref: > users.id]
  joined_at timestamp [default: `now()`]

  indexes {
    (community_id, user_id) [unique]
  }
}

///////////////////////////////////////////////////////
// COMMUNITY POSTS
///////////////////////////////////////////////////////
// 3NF: Post is uniquely identified and stores only base facts.

Table community_posts {
  id int [pk, increment]
  community_id int [not null, ref: > communities.id]
  user_id int [not null, ref: > users.id]
  content text [not null]
  created_at timestamp [default: `now()`]
}
